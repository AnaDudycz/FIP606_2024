{
  "hash": "863b17c52866ee220240d086711889b3",
  "result": {
    "markdown": "---\ntitle: \"Regressão linear\"\nformat: html\neditor: visual\n---\n\n\nPara dados quantitativos, a análise de regressão costuma ser mais adequada do que a análise de variância. A regressão permite modelar e prever a relação entre uma variável dependente e uma ou mais variáveis independentes.\n\n## Regressão linear simples\n\nNa regressão linear simples determina-se uma linha reta que melhor represente essa relação, permitindo prever valores da variável dependente a partir dos valores da variável independente.\n\n## Carregando a planilha\n\n\n::: {.cell hash='Aula11_cache/html/unnamed-chunk-1_2ce105c0a044df8c72cff21914c07b5f'}\n\n```{.r .cell-code}\nlibrary(gsheet)\nestande <- gsheet2tbl(\"https://docs.google.com/spreadsheets/d/1bq2N19DcZdtax2fQW9OHSGMR0X2__Z9T/edit#gid=401662555\")\n```\n:::\n\n\n## Visualização\n\nO geom_jitter() forma o gráfico de dispersão. Visualização da média e os intervalos de confiança dos dados.\n\n\n::: {.cell hash='Aula11_cache/html/unnamed-chunk-2_1617972b798e502098970e6eaebd180a'}\n\n```{.r .cell-code}\nlibrary(ggplot2)\nm1 <- estande |>\n  ggplot(aes(trat, nplants))+\n         geom_jitter(width = 0.1, alpha = 0.2)+\n         #facet_wrap(~ trat)+\n         stat_summary(fun.data = \n                 \"mean_cl_boot\", size= 0.5, color=\n                 \"blue\")\nm1\n```\n\n::: {.cell-output-display}\n![](Aula11_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\n\n## Analisando cada experimento isoladamente\n\nA regressão linear precisa definir um modelo que melhor se ajuste a curva ou linha de resposta. Portanto, deve-se fazer a análise para cada experimento ou analisar em grupos (modelos mistos).\n\nA função geom_smooth(se = F, method = lm) permite adicionar uma linha de regressão linear sem intervalo de confiança.\n\n**Experimento 1**\n\nR² mostra a relação entre a reta e os pontos que estão sendo observados (relação entre váriavel dependente e independente). O R² varia de 0 a 1.\n\nQuanto mais próximo de 1 o valor do R², maior é a proporção da variabilidade na variável dependente que pode ser explicada pelo modelo de regressão. R² mais próximo de 0 indica que o modelo explica uma menor proporção da variabilidade na variável dependente.\n\n\n::: {.cell hash='Aula11_cache/html/unnamed-chunk-3_0f3b6800e9355362e61d3defd068b04f'}\n\n```{.r .cell-code}\nlibrary(dplyr)\nexp1 <- estande |> \n  filter(exp == 1)\n\nexp1 |>\n  ggplot(aes(trat, nplants))+\n  geom_point()+\n  ylim(0,100)+\n  geom_smooth(se = F, method = lm)\n```\n\n::: {.cell-output-display}\n![](Aula11_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n\n```{.r .cell-code}\nlm1 <- lm(nplants ~trat,\n          data = exp1)\nsummary(lm1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nlm(formula = nplants ~ trat, data = exp1)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-25.500  -6.532   1.758   8.573  27.226 \n\nCoefficients:\n            Estimate Std. Error t value Pr(>|t|)    \n(Intercept)  52.5000     4.2044  12.487 1.84e-11 ***\ntrat         -0.2419     0.1859  -1.301    0.207    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 15 on 22 degrees of freedom\nMultiple R-squared:  0.07148,\tAdjusted R-squared:  0.02928 \nF-statistic: 1.694 on 1 and 22 DF,  p-value: 0.2066\n```\n:::\n:::\n\n\n**Experimento 2**\n\n\n::: {.cell hash='Aula11_cache/html/unnamed-chunk-4_ed7a996ea2ac2d4de9f7fb68948aaba3'}\n\n```{.r .cell-code}\nexp2 <- estande |> \n  filter(exp == 2)\n\nexp2 |> \n  ggplot(aes(trat, nplants))+\n  geom_point()+\n  ylim(0,100)+\n  geom_smooth(method= \"lm\", \n              se=FALSE, \n              formula = y ~poly(x,2), color=\"black\")+\n  geom_smooth(method = \"lm\",\n              se = FALSE)\n```\n\n::: {.cell-output-display}\n![](Aula11_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# modelo linear\n\nexp2$trat2 <- exp2$trat^2 \n  \n# primeira ordem\nlm2 <- lm(nplants ~ trat, \n          data = exp2)\n# segunda ordem ou quadrático\nlm3 <- lm(nplants ~ trat + trat2 , \n          data = exp2)\n\nsummary(lm2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nlm(formula = nplants ~ trat, data = exp2)\n\nResiduals:\n     Min       1Q   Median       3Q      Max \n-25.7816  -7.7150   0.5653   8.1929  19.2184 \n\nCoefficients:\n            Estimate Std. Error t value Pr(>|t|)    \n(Intercept)  60.9857     3.6304  16.798 4.93e-14 ***\ntrat         -0.7007     0.1605  -4.365 0.000247 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 12.95 on 22 degrees of freedom\nMultiple R-squared:  0.4641,\tAdjusted R-squared:  0.4398 \nF-statistic: 19.05 on 1 and 22 DF,  p-value: 0.0002473\n```\n:::\n\n```{.r .cell-code}\nsummary(lm3)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nlm(formula = nplants ~ trat + trat2, data = exp2)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-25.439  -6.019   1.789   8.016  19.561 \n\nCoefficients:\n            Estimate Std. Error t value Pr(>|t|)    \n(Intercept) 66.30156    4.42097  14.997 1.08e-12 ***\ntrat        -1.77720    0.58467  -3.040  0.00623 ** \ntrat2        0.02223    0.01166   1.906  0.07036 .  \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 12.24 on 21 degrees of freedom\nMultiple R-squared:  0.5432,\tAdjusted R-squared:  0.4997 \nF-statistic: 12.49 on 2 and 21 DF,  p-value: 0.0002675\n```\n:::\n\n```{.r .cell-code}\nAIC(lm2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 194.9597\n```\n:::\n\n```{.r .cell-code}\nAIC(lm3)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 193.1284\n```\n:::\n:::\n\n\n**Experimento 3**\n\n\n::: {.cell hash='Aula11_cache/html/unnamed-chunk-5_dcd71d94b2c0a9fd855c11fe03550864'}\n\n```{.r .cell-code}\nexp3 <- estande |>\n  filter(exp==3)\n\nexp3 |>\n  ggplot(aes(trat, nplants))+\n  geom_point()+\n  ylim(0,100)+\n  geom_smooth(se = F, method = lm)\n```\n\n::: {.cell-output-display}\n![](Aula11_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n\n```{.r .cell-code}\nexp3\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 24 × 4\n     exp  trat bloco nplants\n   <dbl> <dbl> <dbl>   <dbl>\n 1     3     0     1     101\n 2     3     0     2      94\n 3     3     0     3      93\n 4     3     0     4     105\n 5     3     3     1      93\n 6     3     3     2      97\n 7     3     3     3      96\n 8     3     3     4     109\n 9     3     6     1      99\n10     3     6     2      95\n# ℹ 14 more rows\n```\n:::\n\n```{.r .cell-code}\n#modelo linear\nlm3 <- lm(nplants ~trat,\n          data = exp3)\nsummary(lm3)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nlm(formula = nplants ~ trat, data = exp3)\n\nResiduals:\n     Min       1Q   Median       3Q      Max \n-26.5887  -3.9597   0.7177   5.5806  19.8952 \n\nCoefficients:\n            Estimate Std. Error t value Pr(>|t|)    \n(Intercept)  95.7500     2.9529  32.425  < 2e-16 ***\ntrat         -0.7634     0.1306  -5.847 6.97e-06 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 10.53 on 22 degrees of freedom\nMultiple R-squared:  0.6085,\tAdjusted R-squared:  0.5907 \nF-statistic: 34.19 on 1 and 22 DF,  p-value: 6.968e-06\n```\n:::\n:::\n\n\n## Modelo GLM\n\nO Modelo Linear Generalizado (GLM) representa uma alternativa ao modelo linear convencional, sendo uma extensão que oferece flexibilidade para lidar com diversos tipos de variáveis resposta(categóricas ou contínuas). o GLM também permite modelar relações não-lineares entre a variável resposta e as variáveis explicativas.\n\n\n::: {.cell hash='Aula11_cache/html/unnamed-chunk-6_46953f37c83640dfb46413fac390f77a'}\n\n```{.r .cell-code}\nglm1 <- glm(nplants ~ trat, family = \"gaussian\", data = exp1)\n\nsummary(glm1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nglm(formula = nplants ~ trat, family = \"gaussian\", data = exp1)\n\nCoefficients:\n            Estimate Std. Error t value Pr(>|t|)    \n(Intercept)  52.5000     4.2044  12.487 1.84e-11 ***\ntrat         -0.2419     0.1859  -1.301    0.207    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for gaussian family taken to be 224.9751)\n\n    Null deviance: 5330.5  on 23  degrees of freedom\nResidual deviance: 4949.5  on 22  degrees of freedom\nAIC: 202\n\nNumber of Fisher Scoring iterations: 2\n```\n:::\n\n```{.r .cell-code}\nglm1b <- glm(nplants ~trat, family = \"poisson\",\n             data = exp1)\nsummary(glm1b)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nglm(formula = nplants ~ trat, family = \"poisson\", data = exp1)\n\nCoefficients:\n             Estimate Std. Error z value Pr(>|z|)    \n(Intercept)  3.963738   0.039359 100.708  < 2e-16 ***\ntrat        -0.005199   0.001862  -2.793  0.00523 ** \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for poisson family taken to be 1)\n\n    Null deviance: 111.37  on 23  degrees of freedom\nResidual deviance: 103.31  on 22  degrees of freedom\nAIC: 243.58\n\nNumber of Fisher Scoring iterations: 4\n```\n:::\n\n```{.r .cell-code}\nAIC(glm1b)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 243.5839\n```\n:::\n\n```{.r .cell-code}\nglm2 <- glm(nplants ~ trat, family = \"gaussian\", data = exp1)\n\nsummary(glm2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nglm(formula = nplants ~ trat, family = \"gaussian\", data = exp1)\n\nCoefficients:\n            Estimate Std. Error t value Pr(>|t|)    \n(Intercept)  52.5000     4.2044  12.487 1.84e-11 ***\ntrat         -0.2419     0.1859  -1.301    0.207    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for gaussian family taken to be 224.9751)\n\n    Null deviance: 5330.5  on 23  degrees of freedom\nResidual deviance: 4949.5  on 22  degrees of freedom\nAIC: 202\n\nNumber of Fisher Scoring iterations: 2\n```\n:::\n\n```{.r .cell-code}\nglm2b <- glm(nplants ~trat, family = \"poisson\",\n             data = exp2)\nsummary(glm2b)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nglm(formula = nplants ~ trat, family = \"poisson\", data = exp2)\n\nCoefficients:\n             Estimate Std. Error z value Pr(>|z|)    \n(Intercept)  4.134189   0.037583 110.003  < 2e-16 ***\ntrat        -0.016270   0.002059  -7.901 2.76e-15 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for poisson family taken to be 1)\n\n    Null deviance: 139.783  on 23  degrees of freedom\nResidual deviance:  69.578  on 22  degrees of freedom\nAIC: 210.24\n\nNumber of Fisher Scoring iterations: 4\n```\n:::\n\n```{.r .cell-code}\nAIC(glm2b)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 210.2353\n```\n:::\n\n```{.r .cell-code}\nglm3 <- glm(nplants ~ trat + (trat| exp), family = \"gaussian\", data = exp1)\n\nsummary(glm3)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nglm(formula = nplants ~ trat + (trat | exp), family = \"gaussian\", \n    data = exp1)\n\nCoefficients: (1 not defined because of singularities)\n               Estimate Std. Error t value Pr(>|t|)    \n(Intercept)     52.5000     4.2044  12.487 1.84e-11 ***\ntrat            -0.2419     0.1859  -1.301    0.207    \ntrat | expTRUE       NA         NA      NA       NA    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for gaussian family taken to be 224.9751)\n\n    Null deviance: 5330.5  on 23  degrees of freedom\nResidual deviance: 4949.5  on 22  degrees of freedom\nAIC: 202\n\nNumber of Fisher Scoring iterations: 2\n```\n:::\n\n```{.r .cell-code}\nAIC(glm3)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 202.0045\n```\n:::\n\n```{.r .cell-code}\nglm3b <- glm(nplants ~trat + (trat| exp), family = \"poisson\",\n             data = exp3)\nsummary(glm3b)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nglm(formula = nplants ~ trat + (trat | exp), family = \"poisson\", \n    data = exp3)\n\nCoefficients: (1 not defined because of singularities)\n                Estimate Std. Error z value Pr(>|z|)    \n(Intercept)     4.571590   0.029539 154.762  < 2e-16 ***\ntrat           -0.009965   0.001488  -6.697 2.13e-11 ***\ntrat | expTRUE        NA         NA      NA       NA    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for poisson family taken to be 1)\n\n    Null deviance: 77.906  on 23  degrees of freedom\nResidual deviance: 29.952  on 22  degrees of freedom\nAIC: 183.93\n\nNumber of Fisher Scoring iterations: 4\n```\n:::\n\n```{.r .cell-code}\nAIC(glm3b)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 183.9324\n```\n:::\n:::\n\n\n## Modelo misto\n\nModelo que permite que as observações sejam divididas em grupos ou subgrupos.\n\n\n::: {.cell hash='Aula11_cache/html/unnamed-chunk-7_458fbe2a809f38630d6a0144e61fc585'}\n\n```{.r .cell-code}\nlibrary(remotes)\n##remotes::install_github(\"emdelponte/r4pde\", force = TRUE)\n\nlibrary(r4pde)\nwr <- WhiteMoldSoybean\n\n\nwr |> \n  ggplot(aes(inc, yld, group = factor(study)))+\n  geom_point()+\n  facet_wrap(~ study)+\n  geom_smooth(method = \"lm\", se = F)+\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](Aula11_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n\n```{.r .cell-code}\nmofo1 <- lm(yld ~inc,\n            data = wr)\nsummary(mofo1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nlm(formula = yld ~ inc, data = wr)\n\nResiduals:\n     Min       1Q   Median       3Q      Max \n-1657.85  -594.50   -91.32   531.76  1693.15 \n\nCoefficients:\n            Estimate Std. Error t value Pr(>|t|)    \n(Intercept) 3299.619     56.451  58.451  < 2e-16 ***\ninc           -9.261      2.108  -4.393 1.45e-05 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 745.8 on 380 degrees of freedom\nMultiple R-squared:  0.04833,\tAdjusted R-squared:  0.04582 \nF-statistic:  19.3 on 1 and 380 DF,  p-value: 1.452e-05\n```\n:::\n:::\n\n::: {.cell hash='Aula11_cache/html/unnamed-chunk-8_19023ee9ef8757a727f2733ff67cdb40'}\n\n```{.r .cell-code}\nlibrary(broom)\nmofo2 <- wr |>\n  group_by(study)|>\n  do(tidy(lm(.$yld~.$inc), conf.int=TRUE))\nmofo2\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 70 × 8\n# Groups:   study [35]\n   study term        estimate std.error statistic  p.value conf.low conf.high\n   <dbl> <chr>          <dbl>     <dbl>     <dbl>    <dbl>    <dbl>     <dbl>\n 1     1 (Intercept)  3329.       86.8      38.3  4.60e-13   3138.    3520.  \n 2     1 .$inc         -14.2       2.08     -6.85 2.78e- 5    -18.8     -9.64\n 3     2 (Intercept)  2682.       48.6      55.2  8.55e-15   2575.    2789.  \n 4     2 .$inc          -6.93      1.49     -4.66 6.89e- 4    -10.2     -3.66\n 5     3 (Intercept)  4017.       61.6      65.2  1.37e-15   3882.    4153.  \n 6     3 .$inc         -18.6       1.71    -10.9  3.11e- 7    -22.4    -14.9 \n 7     4 (Intercept)  2814.      151.       18.6  1.15e- 9   2481.    3147.  \n 8     4 .$inc         -43.5      16.8      -2.58 2.56e- 2    -80.5     -6.38\n 9     5 (Intercept)  3317.      234.       14.2  2.07e- 8   2802.    3832.  \n10     5 .$inc         -21.2       5.69     -3.72 3.36e- 3    -33.7     -8.67\n# ℹ 60 more rows\n```\n:::\n\n```{.r .cell-code}\ndf <- mofo2 |> filter(term == \".$inc\")\nmean(df$estimate)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] -19.52932\n```\n:::\n\n```{.r .cell-code}\nfit_all <- wr%>%\n  group_by(study) |> \n  do(broom::tidy(lm(.$yld ~ .$inc), conf.int=TRUE))\nfit_all\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 70 × 8\n# Groups:   study [35]\n   study term        estimate std.error statistic  p.value conf.low conf.high\n   <dbl> <chr>          <dbl>     <dbl>     <dbl>    <dbl>    <dbl>     <dbl>\n 1     1 (Intercept)  3329.       86.8      38.3  4.60e-13   3138.    3520.  \n 2     1 .$inc         -14.2       2.08     -6.85 2.78e- 5    -18.8     -9.64\n 3     2 (Intercept)  2682.       48.6      55.2  8.55e-15   2575.    2789.  \n 4     2 .$inc          -6.93      1.49     -4.66 6.89e- 4    -10.2     -3.66\n 5     3 (Intercept)  4017.       61.6      65.2  1.37e-15   3882.    4153.  \n 6     3 .$inc         -18.6       1.71    -10.9  3.11e- 7    -22.4    -14.9 \n 7     4 (Intercept)  2814.      151.       18.6  1.15e- 9   2481.    3147.  \n 8     4 .$inc         -43.5      16.8      -2.58 2.56e- 2    -80.5     -6.38\n 9     5 (Intercept)  3317.      234.       14.2  2.07e- 8   2802.    3832.  \n10     5 .$inc         -21.2       5.69     -3.72 3.36e- 3    -33.7     -8.67\n# ℹ 60 more rows\n```\n:::\n\n```{.r .cell-code}\np3 <- fit_all |> \n  filter(term == \"(Intercept)\") |> \n  ggplot(aes(x = estimate))+\n  geom_histogram(bins = 8, color = \"white\", fill = \"gray50\")+\n  theme_r4pde()+\n  labs(x = \"Intercept\", y = \"Frequency\")\n\np4 <- fit_all |> \n  filter(term == \".$inc\") |> \n  ggplot(aes(x = estimate))+\n  geom_histogram(bins = 8, color = \"white\", fill = \"gray50\")+\n  theme_r4pde()+\n  labs(x = \"Slope\", y = \"Frequency\")\n\n\nlibrary(patchwork)\np3 | p4\n```\n\n::: {.cell-output-display}\n![](Aula11_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}